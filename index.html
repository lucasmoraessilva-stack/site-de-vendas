loja-online/
‚îÇ
‚îú‚îÄ‚îÄ server.js              # Back-end com rotas de API e Stripe
‚îú‚îÄ‚îÄ db.js                  # Banco SQLite
‚îú‚îÄ‚îÄ .env                   # Chave da API Stripe
‚îÇ
‚îú‚îÄ‚îÄ public/
‚îÇ   ‚îú‚îÄ‚îÄ index.html         # P√°gina da loja
‚îÇ   ‚îú‚îÄ‚îÄ carrinho.html      # P√°gina do carrinho
‚îÇ   ‚îú‚îÄ‚îÄ admin.html         # Painel administrativo
‚îÇ   ‚îú‚îÄ‚îÄ style.css
‚îÇ   ‚îú‚îÄ‚îÄ script.js          # Loja
‚îÇ   ‚îú‚îÄ‚îÄ carrinho.js        # L√≥gica do carrinho
‚îÇ   ‚îî‚îÄ‚îÄ admin.js           # Painel admin
‚îÇ
‚îî‚îÄ‚îÄ package.json
npm install stripe dotenv
STRIPE_SECRET_KEY=sk_test_sla
require("dotenv").config();
const express = require("express");
const cors = require("cors");
const bodyParser = require("body-parser");
const stripe = require("stripe")(process.env.STRIPE_SECRET_KEY);
const db = require("./db");

const app = express();
app.use(cors());
app.use(bodyParser.json());
app.use(express.static("public"));

// Rotas da API
app.get("/api/produtos", (req, res) => {
  db.all("SELECT * FROM produtos", (err, rows) => {
    if (err) res.status(500).json({ erro: err });
    else res.json(rows);
  });
});

app.post("/api/produtos", (req, res) => {
  const { nome, descricao, preco, imagem } = req.body;
  db.run(
    "INSERT INTO produtos (nome, descricao, preco, imagem) VALUES (?, ?, ?, ?)",
    [nome, descricao, preco, imagem],
    function (err) {
      if (err) res.status(500).json({ erro: err });
      else res.json({ id: this.lastID });
    }
  );
});

app.delete("/api/produtos/:id", (req, res) => {
  db.run("DELETE FROM produtos WHERE id = ?", [req.params.id], function (err) {
    if (err) res.status(500).json({ erro: err });
    else res.json({ sucesso: true });
  });
});

// Pagamento com Stripe
app.post("/api/pagar", async (req, res) => {
  const { items } = req.body;

  const lineItems = items.map((item) => ({
    price_data: {
      currency: "brl",
      product_data: { name: item.nome },
      unit_amount: Math.round(item.preco * 100),
    },
    quantity: item.quantidade,
  }));

  const session = await stripe.checkout.sessions.create({
    payment_method_types: ["card"],
    mode: "payment",
    line_items: lineItems,
    success_url: "http://localhost:3000/sucesso.html",
    cancel_url: "http://localhost:3000/carrinho.html",
  });

  res.json({ url: session.url });
});

const PORT = 3000;
app.listen(PORT, () =>
  console.log(`üöÄ Servidor rodando em http://localhost:${PORT}`)
);
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Carrinho de Compras</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header><h1>üõí Carrinho</h1></header>

  <main>
    <div id="lista-carrinho"></div>
    <h3 id="total"></h3>
    <button id="btn-pagar">Finalizar Compra</button>
  </main>

  <script src="carrinho.js"></script>
</body>
</html>
let carrinho = JSON.parse(localStorage.getItem("carrinho")) || [];

function atualizarCarrinho() {
  const lista = document.getElementById("lista-carrinho");
  lista.innerHTML = "";

  let total = 0;

  carrinho.forEach((item, i) => {
    total += item.preco * item.quantidade;
    lista.innerHTML += `
      <div class="produto">
        <h3>${item.nome}</h3>
        <p>R$ ${item.preco.toFixed(2)} x ${item.quantidade}</p>
        <button onclick="removerItem(${i})">Remover</button>
      </div>
    `;
  });

  document.getElementById("total").innerText = `Total: R$ ${total.toFixed(2)}`;
}

function removerItem(index) {
  carrinho.splice(index, 1);
  localStorage.setItem("carrinho", JSON.stringify(carrinho));
  atualizarCarrinho();
}

document.getElementById("btn-pagar").addEventListener("click", async () => {
  const res = await fetch("/api/pagar", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ items: carrinho }),
  });

  const data = await res.json();
  window.location.href = data.url;
});

atualizarCarrinho();
async function carregarProdutos() {
  const res = await fetch("/api/produtos");
  const produtos = await res.json();

  const container = document.getElementById("produtos-container");
  container.innerHTML = "";

  produtos.forEach((p) => {
    const card = document.createElement("div");
    card.className = "produto";
    card.innerHTML = `
      <img src="${p.imagem}" alt="${p.nome}">
      <h3>${p.nome}</h3>
      <p>${p.descricao}</p>
      <strong>R$ ${p.preco.toFixed(2)}</strong>
      <br/>
      <button onclick="adicionarAoCarrinho('${p.nome}', ${p.preco})">Adicionar</button>
    `;
    container.appendChild(card);
  });
}

function adicionarAoCarrinho(nome, preco) {
  let carrinho = JSON.parse(localStorage.getItem("carrinho")) || [];
  const item = carrinho.find((i) => i.nome === nome);
  if (item) item.quantidade++;
  else carrinho.push({ nome, preco, quantidade: 1 });
  localStorage.setItem("carrinho", JSON.stringify(carrinho));
  alert(`‚úÖ ${nome} adicionado ao carrinho!`);
}

carregarProdutos();
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Painel Admin</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header><h1>‚öôÔ∏è Painel Administrativo</h1></header>

  <main>
    <h2>Adicionar Produto</h2>
    <input id="nome" placeholder="Nome" />
    <input id="descricao" placeholder="Descri√ß√£o" />
    <input id="preco" type="number" placeholder="Pre√ßo" />
    <input id="imagem" placeholder="URL da Imagem" />
    <button onclick="adicionarProduto()">Salvar</button>

    <h2>Produtos</h2>
    <div id="lista-produtos"></div>
  </main>

  <script src="admin.js"></script>
</body>
</html>
async function listarProdutos() {
  const res = await fetch("/api/produtos");
  const produtos = await res.json();
  const lista = document.getElementById("lista-produtos");

  lista.innerHTML = produtos
    .map(
      (p) => `
    <div class="produto">
      <h3>${p.nome}</h3>
      <p>${p.descricao}</p>
      <strong>R$ ${p.preco.toFixed(2)}</strong>
      <br/>
      <button onclick="removerProduto(${p.id})">Excluir</button>
    </div>`
    )
    .join("");
}

async function adicionarProduto() {
  const nome = document.getElementById("nome").value;
  const descricao = document.getElementById("descricao").value;
  const preco = parseFloat(document.getElementById("preco").value);
  const imagem = document.getElementById("imagem").value;

  await fetch("/api/produtos", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ nome, descricao, preco, imagem }),
  });

  listarProdutos();
}

async function removerProduto(id) {
  await fetch(`/api/produtos/${id}`, { method: "DELETE" });
  listarProdutos();
}

listarProdutos();

